@startuml Zustandsdiagramm_Anzeige_Freie_Plaetze

title ZUSTANDSDIAGRAMM - Anzeige der freien Parkplaetze

[*] --> Initialisierung : System startet

Initialisierung --> Daten_laden : Alle Daten geladen
Daten_laden --> Anzeige_aktualisieren : Daten erfolgreich geladen
Anzeige_aktualisieren --> Warten_auf_Aenderungen : Display aktualisiert

Warten_auf_Aenderungen --> Daten_laden : Timer abgelaufen (30s)
Warten_auf_Aenderungen --> Daten_laden : Einfahrt/Ausfahrt erkannt
Warten_auf_Aenderungen --> Daten_laden : Manueller Update-Button

Daten_laden --> Fehlerzustand : Datenbankfehler
Fehlerzustand --> Daten_laden : Retry-Mechanismus
Fehlerzustand --> Wartungsmodus : Retry-Limit erreicht (3x)

Wartungsmodus --> Initialisierung : Wartungsmodus beendet

note right of Initialisierung
  Entry: loadSystemConfig()
  Do: initializeSystem()
  Exit: cleanupInitialization()

  - Datenbankverbindung herstellen
  - Parkhaus-Konfiguration laden
  - Alle Parkplaetze abfragen
end note

note right of Daten_laden
  Entry: executeDatabaseQuery()
  Do: loadParkingData()
  Exit: cleanupQuery()

  - SQL-Query ausfuehren
  - Status aller Parkplaetze ermitteln
  - Freie Plaetze zaehlen
end note

note right of Anzeige_aktualisieren
  Entry: updateDisplay()
  Do: refreshDisplay()
  Exit: cleanupDisplay()

  - Freie Plaetze pro Ebene anzeigen
  - Gesamtanzahl freier Plaetze anzeigen
  - Farbkodierung aktualisieren
  (Gruen = frei, Rot = besetzt)
end note

note right of Warten_auf_Aenderungen
  Entry: startTimer()
  Do: monitorEvents()
  Exit: stopTimer()

  - Timer laeuft (30 Sekunden)
  - Event-Listener aktiv
  - Keine Anzeige-Updates
end note

note right of Fehlerzustand
  Entry: showErrorMessage()
  Do: handleError()
  Exit: cleanupError()

  - Fehlermeldung anzeigen
  - Retry-Mechanismus aktivieren
  - Log-Eintrag erstellen
  - Retry nach 5 Sekunden
end note

note right of Wartungsmodus
  Entry: activateMaintenanceMode()
  Do: maintainSystem()
  Exit: deactivateMaintenanceMode()

  - "Wartung" anzeigen
  - Alle Anzeigen deaktivieren
  - Wartungssignal senden
end note

note bottom
  DIAGRAMMTYP: Zustaendsdiagramm (State Diagram)
  ZIEL: Darstellung der verschiedenen Systemzustaende und Uebergaenge

  Performance-Optimierungen:
  - Daten-Cache: 30 Sekunden
  - Asynchrone Updates
  - Event-driven Updates
  - Non-blocking UI
end note

@enduml
